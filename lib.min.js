// The MIT License (MIT)
//
// Copyright (c) 2013 Artem S Vybornov
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

// The MIT License (MIT)
// Copyright base-x contributors (c) 2016
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

// https://github.com/cryptocoinjs/base-x/blob/master/index.js
// base-x encoding
// Forked from https://github.com/cryptocoinjs/bs58
// Originally written by Mike Hearn for BitcoinJ
// Copyright (c) 2011 Google Inc
// Ported to JavaScript by Stefan Thomas
// Merged Buffer refactorings from base58-native by Stephen Pair
// Copyright (c) 2013 BitPay Inc

// Copyright (c) 2017 Pieter Wuille
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

// ISC License

// Copyright (c) 2013-2016 The btcsuite developers

// Permission to use, copy, modify, and distribute this software for any
// purpose with or without fee is hereby granted, provided that the above
// copyright notice and this permission notice appear in all copies.

// THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
// WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
// ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
// WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
// ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
// OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

const CHARSET="qpzry9x8gf2tvdw0s3jn54khce6mua7l",CHARSET_MAP={q:0,p:1,z:2,r:3,y:4,9:5,x:6,8:7,g:8,f:9,2:10,t:11,v:12,d:13,w:14,0:15,s:16,3:17,j:18,n:19,5:20,4:21,k:22,h:23,c:24,e:25,6:26,m:27,u:28,a:29,7:30,l:31},ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",ALPHABET_MAP={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,A:9,B:10,C:11,D:12,E:13,F:14,G:15,H:16,J:17,K:18,L:19,M:20,N:21,P:22,Q:23,R:24,S:25,T:26,U:27,V:28,W:29,X:30,Y:31,Z:32,a:33,b:34,c:35,d:36,e:37,f:38,g:39,h:40,i:41,j:42,k:43,m:44,n:45,o:46,p:47,q:48,r:49,s:50,t:51,u:52,v:53,w:54,x:55,y:56,z:57};function parseAndConvertCashAddress(r,e){for(var t=[],n=0;n<e.length;n++){if(void 0==e[n])throw"Unexpected character!";t.push(CHARSET_MAP[e[n]])}var o=[],c=!0;"bitcoincash"==r?o=[2,9,20,3,15,9,14,3,1,19,8,0]:(o=[2,3,8,20,5,19,20,0],c=!1);var a=o.concat(t),s=polyMod(a);for(n=0;n<s.length;n++)if(0!=s[n]){for(var f=[],h=0,i=0;i<a.length;i++)for(var d=1;d<32;d++){a[i]^=d,f=polyMod(a),h=0;for(var l=0;l<f.length;l++)h+=f[l];if(0==h)return correctedAddress=rebuildAddress(a),document.getElementById("correctedButton").style="","";a[i]^=d}throw"Can't correct errors!"}var u=convertBits(t.slice(0,-8),5,8,!1);return craftOldAddress(u[0]>>3,u.slice(1,21),c)}function craftOldAddress(r,e,t){return CheckEncodeBase58(e,t?0==r?0:5:0==r?111:196)}function CheckEncodeBase58(r,e){var t=[e];t=t.concat(r);var n=sha256(Uint8Array.from(t)),o=sha256(n);return EncodeBase58Simplified(t=t.concat(Array.from(o).slice(0,4)))}function EncodeBase58Simplified(r){for(var e=[0],t=0;t<r.length;t++){for(var n=0,o=r[t];n<e.length;n++)o+=e[n]<<8,e[n]=o%58,o=o/58|0;for(;o>0;)e.push(o%58),o=o/58|0}var c="";for(t=0;t<r.length&&0===r[t];t++)c=c.concat("1");for(var a=e.length-1;a>=0;a--)c=c.concat(ALPHABET[e[a]]);return c}function parseAndConvertOldAddress(r){for(var e=[0],t=0;t<r.length;t++){var n=ALPHABET_MAP[r[t]];if(void 0==n)throw"Unexpected character!";for(var o=0;o<e.length;o++)n+=58*e[o],e[o]=255&n,n>>=8;for(;n>0;)e.push(255&n),n>>=8}for(t=0;t<r.length&&"1"===r[t];t++)e.push(0);var c=(e=e.reverse())[0],a=sha256(Uint8Array.from(e.slice(0,-4))),s=sha256(a);if(s[0]!=e[e.length-4]||s[1]!=e[e.length-3]||s[2]!=e[e.length-2]||s[3]!=e[e.length-1])throw"Address checksum doesn't match! Did you type it wrong?";var f=e.slice(1,e.length-4);if(0==c)return craftCashAddress(0,f,!0);if(5==c)return craftCashAddress(1,f,!0);if(111==c)return craftCashAddress(0,f,!1);if(196==c)return craftCashAddress(1,f,!1);if(28==c)return craftCashAddress(0,f,!0);if(40==c)return craftCashAddress(1,f,!0);throw"Unknown version byte"}function packCashAddressData(r,e){return convertBits([r<<3].concat(e),8,5,!0)}function convertBits(r,e,t,n){for(var o=0,c=0,a=[],s=(1<<t)-1,f=(1<<e+t-1)-1,h=0;h<r.length;h++){var i=r[h];if(i<0||i>>e!=0)throw"convertBits error!";for(o=(o<<e|i)&f,c+=e;c>=t;)c-=t,a.push(o>>c&s)}if(n)c>0&&a.push(o<<t-c&s);else if(c>=e||0!=(o<<t-c&s))throw"convertBits error!";return a}function craftCashAddress(r,e,t){for(var n=packCashAddressData(r,e),o=polyMod((1==t?[2,9,20,3,15,9,14,3,1,19,8,0]:[2,3,8,20,5,19,20,0]).concat(n).concat([0,0,0,0,0,0,0,0])),c=[],a=0;a<8;a++)c[a]=simplify(and(rShift(o,5*(7-a)),[31]))[0];var s=n.concat(c),f="";f=1==t?"bitcoincash:":"bchtest:";for(a=0;a<s.length;a++)f=f.concat(CHARSET[s[a]]);if(54==f.length||50==f.length)return f;throw"Unexpected converted address length!"}function and(r,e){var t=r.length-e.length;if(c=[],t>=0)for(var n=0;n<e.length;n++)c.push(r[n+t]&e[n]);else for(n=0;n<r.length;n++)c.push(r[n]&e[n-t]);return c}function xor(r,e){var t=r.length-e.length,n=[];t>0?e=Array(t).fill(0).concat(e):t<0&&(r=Array(-t).fill(0).concat(r));for(var o=0;o<r.length;o++)n.push(r[o]^e[o]);return n}function rShift(r,e){if(0===r.length)return[0];if(e>31){var t=r.slice(0,-1);e-=32}else t=r.slice(0);if(0===e)return t;for(var n=t.length-1;n>0;n--)t[n]>>>=e,t[n]|=(t[n-1]&(2<<e+1)-1)<<32-e;return t[0]>>>=e,0===t[0]?t.slice(1):t}function add5zerosAtTheEnd(r){r=[0].concat(r);for(var e=1;e<r.length;e++)r[e-1]|=r[e]>>>27,r[e]<<=5;return r}function polyMod(r){for(var e=[0,1],t=[0],n=0;n<r.length;n++)t=rShift(e,35),e=xor(add5zerosAtTheEnd(and(e,[7,-1])),[r[n]]),0!==t.length&&(1&t[0]&&(e=xor(e,[152,4072443489])),2&t[0]&&(e=xor(e,[121,3077413346])),4&t[0]&&(e=xor(e,[243,1046459332])),8&t[0]&&(e=xor(e,[174,783016616])),16&t[0]&&(e=xor(e,[30,1329849456])));return xor(e,[1])}function rebuildAddress(r){for(var e="",t=0;0!=r[t]&&t<r.length;)e=e.concat(String.fromCharCode(96+r[t])),t++;for(e=e.concat(":"),t++;t<r.length;t++)e=e.concat(CHARSET[r[t]]);return e}function simplify(r){if(0===r.length)return[0];for(var e=0;0===r[e];)e++;var t=r.slice(e);return 0===t.length&&(t=[0]),t}